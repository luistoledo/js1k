b.style.cursor="crosshair";g=null;M=Math;ab=M.abs;R=M.random;c.scale(9,9);W=c.canvas.width/9;H=c.canvas.height/9;k=[];t=[];e=[];f=j=z=mb=mx=my=0;no=function(a,d,h,l,m){return{x:a||R()*W,y:d||R()*H,a:h||0,c:l||0,d:m||0}};p=no(W/2,H/2,g,"#0f0");p.b=10;
ud=function(a,d){a.d?(.05>R()&&(a.a=fm(a,p)),t.forEach(function(h){co(h,a)&&(e.splice(d,1),z++,j="#fff",f=300)}),co(p,a)&&(p.b--,j="red",f=400)):(1>W-a.x||1>H-a.y)&&t.splice(d,1);a.a&&(a.x-=M.cos(a.a),a.y-=M.sin(a.a));c.fillStyle=a.c;c.fillRect(a.x,a.y,1,1)};fm=function(a,d){return M.atan2(a.y-d.y,a.x-d.x)};co=function(a,d){return 2>ab(a.x-d.x)+ab(a.y-d.y)};
gl=function(){c.fillStyle=j;c.fillRect(0,0,W,H);j="#fde";t.forEach(ud);c.fillText("k:"+z+" h:"+p.b,0,9);1>p.b?v.stop():(v.frequency.setValueAtTime(f,ac.currentTime),f=0,mb&&.8<R()&&(t.push(no(p.x,p.y,fm(p,no(mx,my)),"Tan",0)),f=200),1>Date.now()%45&&e.push(no(g,g,g,"red",1)),e.forEach(ud),p.y+=.5*(k[83]|0-k[87]|0),p.x+=.5*(k[68]|0-k[65]|0),ud(p,0),requestAnimationFrame(gl))};ac=new AudioContext;v=ac.createOscillator();v.connect(ac.destination);v.start(0);gl();b.onkeydown=function(a){k[a.keyCode]=1};b.onkeyup=function(a){k[a.keyCode]=0};
b.onmousemove=function(a){mx=a.layerX/9;my=a.layerY/9};b.onmousedown=function(){++mb};b.onmouseup=function(){--mb};