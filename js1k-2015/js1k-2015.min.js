u=g=null;M=Math;B=M.abs;R=M.random;c.scale(9,9);W=c.canvas.width/9;H=c.canvas.height/9;k=[];t=[];e=[];f=j=z=mb=mx=my=0;O=function(a,d,h,l,m){return{x:a||R()*W,y:d||R()*H,a:h||0,c:l||0,d:m||0}};p=O(W/2,H/2,g,"#0f0");p.b=10;D=function(a,d){a.d?(.05>R()&&(a.a=A(a,p)),t.forEach(function(h){C(h,a)&&(e.splice(d,1),z++,j="#fff",f=300)}),C(p,a)&&(p.b--,j="red",f=400)):(1>W-a.x||1>H-a.y)&&t.splice(d,1);a.a&&(a.x-=M.cos(a.a),a.y-=M.sin(a.a));c.fillStyle=a.c;c.fillRect(a.x,a.y,1,1)};
A=function(a,d){return M.atan2(a.y-d.y,a.x-d.x)};C=function(a,d){return 2>B(a.x-d.x)+B(a.y-d.y)};G=function(){c.fillStyle=j;c.fillRect(0,0,W,H);j="#fde";t.forEach(D);c.fillText("k:"+z+" h:"+p.b,0,9);1>p.b?v.stop():(v.frequency.setValueAtTime(f,ac.currentTime),f=0,mb&&.8<R()&&(t.push(O(p.x,p.y,A(p,O(mx,my)),"Tan",0)),f=200),1>Date.now()%45&&e.push(O(g,g,g,"red",1)),.99<R()&&(u=O(g,g,g,"#000")),u&&(D(u),C(p,u)&&(u=g,z+=e.i,e=[],j="#fff",f=999)),e.forEach(D),p.y+=.5*(k[83]|0-k[87]|0),p.x+=.5*(k[68]|0-k[65]|0),D(p,0),requestAnimationFrame(G))};
ac=new AudioContext;v=ac.createOscillator();v.connect(ac.destination);v.start(0);G();onkeydown=function(a){k[a.keyCode]=1};onkeyup=function(a){k[a.keyCode]=0};onmousemove=function(a){mx=a.layerX/9;my=a.layerY/9};onmousedown=function(){++mb};onmouseup=function(){--mb};